{"ast":null,"code":"import { ApplicationCancelError, buildApplicationCancelTokenSource } from '@frontapp/ui-bridge';\nexport * from '@frontapp/ui-bridge';\nimport cuid from 'cuid';\nimport { Observable, fromEvent } from 'rxjs';\nimport { take, publish, filter, publishReplay, map } from 'rxjs/operators';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nfunction __generator(thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n}\n\nvar WebViewMessageTypesEnum;\n\n(function (WebViewMessageTypesEnum) {\n  WebViewMessageTypesEnum[\"CONTEXT_UPDATE\"] = \"context_update\";\n  WebViewMessageTypesEnum[\"FUNCTION_CALL\"] = \"function_call\";\n  WebViewMessageTypesEnum[\"FUNCTION_CANCEL\"] = \"function_cancel\";\n  WebViewMessageTypesEnum[\"FUNCTION_RESULT\"] = \"function_result\";\n  WebViewMessageTypesEnum[\"FUNCTION_ERROR\"] = \"function_error\";\n})(WebViewMessageTypesEnum || (WebViewMessageTypesEnum = {}));\n/*\n * WebView to AppSDK.\n */\n\n\nvar webViewBridgeHandshake = '@frontapp/ui-sdk#WebViewBridge.handshake';\n/*\n * Type guards.\n */\n\nfunction isContextUpdateMessageWithPort(message) {\n  return message.type === WebViewMessageTypesEnum.CONTEXT_UPDATE;\n}\n\nfunction isFunctionResultMessage(message) {\n  return message.type === WebViewMessageTypesEnum.FUNCTION_RESULT || message.type === WebViewMessageTypesEnum.FUNCTION_ERROR;\n}\n/*\n * SDK.\n */\n\n\nfunction buildWebViewSdk() {\n  /*\n   * Core observable.\n   */\n  var _this = this; // Create an observable for any hostmessage without ever unsubscribing.\n\n\n  var messages = new Observable(function (next) {\n    return connectToParent().subscribe(next);\n  }).pipe(publish(), connectOnSubscribe());\n  var contextUpdates = messages.pipe(filter(isContextUpdateMessageWithPort), publishReplay(1), connectOnSubscribe());\n  /*\n   * Context function forwarders.\n   */\n\n  var proxyFunctionCall = function (port, callId, contextId, name, args) {\n    port.postMessage({\n      type: WebViewMessageTypesEnum.FUNCTION_CALL,\n      id: callId,\n      contextId: contextId,\n      name: name,\n      args: args\n    });\n    return messages.pipe(filter(isFunctionResultMessage), filter(function (m) {\n      return m.id === callId;\n    }), map(function (m) {\n      switch (m.type) {\n        case WebViewMessageTypesEnum.FUNCTION_RESULT:\n          return m.value;\n\n        case WebViewMessageTypesEnum.FUNCTION_ERROR:\n        default:\n          throw new Error(String(m.error));\n      }\n    }), take(1));\n  };\n\n  var proxyFunctionCancel = function (port, callId) {\n    port.postMessage({\n      type: WebViewMessageTypesEnum.FUNCTION_CANCEL,\n      id: callId\n    });\n  };\n  /*\n   * Context proxy.\n   */\n\n\n  var contextProxyUpdates = contextUpdates.pipe(map(function (_a) {\n    var port = _a.port,\n        context = _a.context;\n    return new Proxy(context, {\n      get: function (target, property) {\n        var propertyName = String(property);\n        var functionArity = target.functionArities[propertyName]; // If the property exists or it is not a function with arity, let the target handle it.\n\n        if (property in target || !Number.isInteger(functionArity)) return target[property]; // Otherwise, create the function.\n\n        return function () {\n          var args = [];\n\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n\n          var callId = cuid(); // Extract the cancel token.\n\n          var cancelTokenIndex = functionArity - 1;\n          var cancelToken = args[cancelTokenIndex]; // Do not send the cancel token in the proxied arguments.\n\n          var argsToSend = args.slice(0, cancelTokenIndex);\n          return new Promise(function (resolve, reject) {\n            var subscription = proxyFunctionCall(port, callId, context.id, propertyName, argsToSend).subscribe({\n              next: resolve,\n              error: reject\n            });\n            if (cancelToken) cancelToken.promise.then(function () {\n              if (subscription.closed) return;\n              subscription.unsubscribe();\n              reject(new ApplicationCancelError());\n              proxyFunctionCancel(port, callId);\n            });\n          });\n        };\n      }\n    });\n  }));\n  var baseBridge = {\n    contextUpdates: contextProxyUpdates,\n    buildCancelTokenSource: buildApplicationCancelTokenSource,\n    isCancelError: function (error) {\n      return error instanceof ApplicationCancelError;\n    }\n  };\n  /*\n   * SDK proxy.\n   */\n\n  return new Proxy(baseBridge, {\n    get: function (target, property) {\n      // If the property exists on the target, return it.\n      if (property in target) return target[property]; // Otherwise, assume that it's an async function call.\n\n      return function () {\n        var args = [];\n\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n\n        return new Promise(function (resolve, reject) {\n          contextProxyUpdates.pipe(take(1)).subscribe({\n            next: function (context) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var contextValue, error, _a, error_1;\n\n                return __generator(this, function (_b) {\n                  switch (_b.label) {\n                    case 0:\n                      contextValue = context[property];\n\n                      if (contextValue === undefined) {\n                        error = String(property) + \" is not a valid function for context \" + context.type + \".\";\n                        reject(new ReferenceError(error));\n                        return [2\n                        /*return*/\n                        ];\n                      }\n\n                      _b.label = 1;\n\n                    case 1:\n                      _b.trys.push([1, 3,, 4]);\n\n                      _a = resolve;\n                      return [4\n                      /*yield*/\n                      , contextValue.apply(void 0, args)];\n\n                    case 2:\n                      _a.apply(void 0, [_b.sent()]);\n\n                      return [3\n                      /*break*/\n                      , 4];\n\n                    case 3:\n                      error_1 = _b.sent();\n                      reject(error_1);\n                      return [3\n                      /*break*/\n                      , 4];\n\n                    case 4:\n                      return [2\n                      /*return*/\n                      ];\n                  }\n                });\n              });\n            },\n            error: reject\n          });\n        });\n      };\n    }\n  });\n}\n\nvar Front = buildWebViewSdk();\nvar contextUpdates = Front.contextUpdates,\n    buildCancelTokenSource = Front.buildCancelTokenSource,\n    isCancelError = Front.isCancelError;\n/*\n * Helpers.\n */\n\nfunction connectToParent() {\n  // eslint-disable-next-line no-undef\n  var parent = window.parent;\n\n  var _a = new MessageChannel(),\n      port1 = _a.port1,\n      port2 = _a.port2;\n\n  var messages = fromEvent(port1, 'message').pipe(map(function (e) {\n    return __assign(__assign({}, e.data), {\n      port: port1\n    });\n  })); // Start the port and send the handshake.\n\n  port1.start();\n  parent.postMessage(webViewBridgeHandshake, '*', [port2]);\n  return messages;\n}\n\nfunction connectOnSubscribe() {\n  return function (source) {\n    if (!isConnectableObservable(source)) return source;\n    return new Observable(function (next) {\n      var subscription = source.subscribe(next);\n      source.connect();\n      return subscription;\n    });\n  };\n}\n\nfunction isConnectableObservable(source) {\n  return typeof source.connect === 'function';\n}\n\nexport default Front;\nexport { buildCancelTokenSource, contextUpdates, isCancelError };","map":{"version":3,"sources":["/Users/jason/Code/dugjason/front-plugin-react/node_modules/@frontapp/plugin-sdk/dist/index.es.js"],"names":["ApplicationCancelError","buildApplicationCancelTokenSource","cuid","Observable","fromEvent","take","publish","filter","publishReplay","map","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","WebViewMessageTypesEnum","webViewBridgeHandshake","isContextUpdateMessageWithPort","message","type","CONTEXT_UPDATE","isFunctionResultMessage","FUNCTION_RESULT","FUNCTION_ERROR","buildWebViewSdk","_this","messages","connectToParent","subscribe","pipe","connectOnSubscribe","contextUpdates","proxyFunctionCall","port","callId","contextId","name","args","postMessage","FUNCTION_CALL","id","m","Error","String","error","proxyFunctionCancel","FUNCTION_CANCEL","contextProxyUpdates","_a","context","Proxy","get","target","property","propertyName","functionArity","functionArities","Number","isInteger","_i","cancelTokenIndex","cancelToken","argsToSend","slice","subscription","promise","closed","unsubscribe","baseBridge","buildCancelTokenSource","isCancelError","contextValue","error_1","_b","undefined","ReferenceError","Front","parent","window","MessageChannel","port1","port2","data","start","source","isConnectableObservable","connect"],"mappings":"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","sourcesContent":["import { ApplicationCancelError, buildApplicationCancelTokenSource } from '@frontapp/ui-bridge';\nexport * from '@frontapp/ui-bridge';\nimport cuid from 'cuid';\nimport { Observable, fromEvent } from 'rxjs';\nimport { take, publish, filter, publishReplay, map } from 'rxjs/operators';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar WebViewMessageTypesEnum;\n(function (WebViewMessageTypesEnum) {\n    WebViewMessageTypesEnum[\"CONTEXT_UPDATE\"] = \"context_update\";\n    WebViewMessageTypesEnum[\"FUNCTION_CALL\"] = \"function_call\";\n    WebViewMessageTypesEnum[\"FUNCTION_CANCEL\"] = \"function_cancel\";\n    WebViewMessageTypesEnum[\"FUNCTION_RESULT\"] = \"function_result\";\n    WebViewMessageTypesEnum[\"FUNCTION_ERROR\"] = \"function_error\";\n})(WebViewMessageTypesEnum || (WebViewMessageTypesEnum = {}));\n/*\n * WebView to AppSDK.\n */\nvar webViewBridgeHandshake = '@frontapp/ui-sdk#WebViewBridge.handshake';\n/*\n * Type guards.\n */\nfunction isContextUpdateMessageWithPort(message) {\n    return message.type === WebViewMessageTypesEnum.CONTEXT_UPDATE;\n}\nfunction isFunctionResultMessage(message) {\n    return (message.type === WebViewMessageTypesEnum.FUNCTION_RESULT ||\n        message.type === WebViewMessageTypesEnum.FUNCTION_ERROR);\n}\n\n/*\n * SDK.\n */\nfunction buildWebViewSdk() {\n    /*\n     * Core observable.\n     */\n    var _this = this;\n    // Create an observable for any hostmessage without ever unsubscribing.\n    var messages = new Observable(function (next) { return connectToParent().subscribe(next); }).pipe(publish(), connectOnSubscribe());\n    var contextUpdates = messages.pipe(filter(isContextUpdateMessageWithPort), publishReplay(1), connectOnSubscribe());\n    /*\n     * Context function forwarders.\n     */\n    var proxyFunctionCall = function (port, callId, contextId, name, args) {\n        port.postMessage({\n            type: WebViewMessageTypesEnum.FUNCTION_CALL,\n            id: callId,\n            contextId: contextId,\n            name: name,\n            args: args\n        });\n        return messages.pipe(filter(isFunctionResultMessage), filter(function (m) { return m.id === callId; }), map(function (m) {\n            switch (m.type) {\n                case WebViewMessageTypesEnum.FUNCTION_RESULT:\n                    return m.value;\n                case WebViewMessageTypesEnum.FUNCTION_ERROR:\n                default:\n                    throw new Error(String(m.error));\n            }\n        }), take(1));\n    };\n    var proxyFunctionCancel = function (port, callId) {\n        port.postMessage({ type: WebViewMessageTypesEnum.FUNCTION_CANCEL, id: callId });\n    };\n    /*\n     * Context proxy.\n     */\n    var contextProxyUpdates = contextUpdates.pipe(map(function (_a) {\n        var port = _a.port, context = _a.context;\n        return new Proxy(context, {\n            get: function (target, property) {\n                var propertyName = String(property);\n                var functionArity = target.functionArities[propertyName];\n                // If the property exists or it is not a function with arity, let the target handle it.\n                if (property in target || !Number.isInteger(functionArity))\n                    return target[property];\n                // Otherwise, create the function.\n                return function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    var callId = cuid();\n                    // Extract the cancel token.\n                    var cancelTokenIndex = functionArity - 1;\n                    var cancelToken = args[cancelTokenIndex];\n                    // Do not send the cancel token in the proxied arguments.\n                    var argsToSend = args.slice(0, cancelTokenIndex);\n                    return new Promise(function (resolve, reject) {\n                        var subscription = proxyFunctionCall(port, callId, context.id, propertyName, argsToSend).subscribe({\n                            next: resolve,\n                            error: reject\n                        });\n                        if (cancelToken)\n                            cancelToken.promise.then(function () {\n                                if (subscription.closed)\n                                    return;\n                                subscription.unsubscribe();\n                                reject(new ApplicationCancelError());\n                                proxyFunctionCancel(port, callId);\n                            });\n                    });\n                };\n            }\n        });\n    }));\n    var baseBridge = {\n        contextUpdates: contextProxyUpdates,\n        buildCancelTokenSource: buildApplicationCancelTokenSource,\n        isCancelError: function (error) { return error instanceof ApplicationCancelError; }\n    };\n    /*\n     * SDK proxy.\n     */\n    return new Proxy(baseBridge, {\n        get: function (target, property) {\n            // If the property exists on the target, return it.\n            if (property in target)\n                return target[property];\n            // Otherwise, assume that it's an async function call.\n            return function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i] = arguments[_i];\n                }\n                return new Promise(function (resolve, reject) {\n                    contextProxyUpdates.pipe(take(1)).subscribe({\n                        next: function (context) { return __awaiter(_this, void 0, void 0, function () {\n                            var contextValue, error, _a, error_1;\n                            return __generator(this, function (_b) {\n                                switch (_b.label) {\n                                    case 0:\n                                        contextValue = context[property];\n                                        if (contextValue === undefined) {\n                                            error = String(property) + \" is not a valid function for context \" + context.type + \".\";\n                                            reject(new ReferenceError(error));\n                                            return [2 /*return*/];\n                                        }\n                                        _b.label = 1;\n                                    case 1:\n                                        _b.trys.push([1, 3, , 4]);\n                                        _a = resolve;\n                                        return [4 /*yield*/, contextValue.apply(void 0, args)];\n                                    case 2:\n                                        _a.apply(void 0, [_b.sent()]);\n                                        return [3 /*break*/, 4];\n                                    case 3:\n                                        error_1 = _b.sent();\n                                        reject(error_1);\n                                        return [3 /*break*/, 4];\n                                    case 4: return [2 /*return*/];\n                                }\n                            });\n                        }); },\n                        error: reject\n                    });\n                });\n            };\n        }\n    });\n}\nvar Front = buildWebViewSdk();\nvar contextUpdates = Front.contextUpdates, buildCancelTokenSource = Front.buildCancelTokenSource, isCancelError = Front.isCancelError;\n/*\n * Helpers.\n */\nfunction connectToParent() {\n    // eslint-disable-next-line no-undef\n    var parent = window.parent;\n    var _a = new MessageChannel(), port1 = _a.port1, port2 = _a.port2;\n    var messages = fromEvent(port1, 'message').pipe(map(function (e) {\n        return (__assign(__assign({}, e.data), { port: port1 }));\n    }));\n    // Start the port and send the handshake.\n    port1.start();\n    parent.postMessage(webViewBridgeHandshake, '*', [port2]);\n    return messages;\n}\nfunction connectOnSubscribe() {\n    return function (source) {\n        if (!isConnectableObservable(source))\n            return source;\n        return new Observable(function (next) {\n            var subscription = source.subscribe(next);\n            source.connect();\n            return subscription;\n        });\n    };\n}\nfunction isConnectableObservable(source) {\n    return typeof source.connect === 'function';\n}\n\nexport default Front;\nexport { buildCancelTokenSource, contextUpdates, isCancelError };\n"]},"metadata":{},"sourceType":"module"}